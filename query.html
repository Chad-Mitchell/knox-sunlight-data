<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Knoxville Sunlight Explorer</title>
  <script src="https://unpkg.com/vis-network@9.1.2/standalone/umd/vis-network.min.js"></script>
  <style>
    body { font-family: system-ui; margin: 2rem; background: #fafafa; }
    #network { width: 100%; height: 80vh; border: 1px solid #ccc; background: #fff; }
    h1 { color: #333; }
  </style>
</head>
<body>
  <h1>Knoxville Money + Power Graph</h1>
  <p>Loading latest data automatically...</p>
  <div id="network"></div>

  <script>
    async function loadGraph() {
      const response = await fetch('data/latest.csv?' + Date.now()); // cache-bust
      const csv = await response.text();
      const lines = csv.trim().split('\n');
      const nodes = new Set();
      const edges = [];

      lines.slice(1).forEach(line => {
        const [source, target, type, amount, date] = line.split(',');
        if (!source || !target) return;
        nodes.add(source.trim());
        nodes.add(target.trim());
        edges.push({
          from: source.trim(),
          to: target.trim(),
          label: type + (amount ? ` $${amount}` : ''),
          title: date,
          color: type === 'donation' ? '#2ca02c' : '#1f77b4'
        });
      });

      const nodeArray = Array.from(nodes).map(id => ({ id, label: id }));
      const container = document.getElementById('network');
      const data = { nodes: nodeArray, edges };
      new vis.Network(container, data, { physics: { stabilization: false } });
    }

    loadGraph().catch(() => {
      document.body.innerHTML += '<p>No data yet â€“ first drop 2025-12-22</p>';
    });
  </script>
</body>
</html>
